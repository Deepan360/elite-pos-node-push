<!DOCTYPE html>
<html lang="en">
<head>
 {{>header}}
     <style>
        #manufacturerform {
                  display: none;
                  position: fixed;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                  background-color: #8f8f8f; /* White background for the form */
                  padding: 20px;
                  z-index: 1000; /* Ensure it's above other elements */
                  border-radius: 10px;
              }
            .editForm {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #8f8f8f;
            padding: 20px;
            z-index: 1000;
            border-radius: 10px;
        }
           
          </style>
    <style>
        .container{
            margin-left: 20%;
        }
        .updateManufacturer{
             background-color: rgba(50, 141, 168) !important;
            color: white !important;
             border: none !important;
                border-radius: 3px !important;
                width: 80px !important;
            height: 30px;
  
        }
        .closeForm{
             background-color: rgba(50, 141, 168) !important;
            color: white !important;
             border: none !important;
                border-radius: 3px !important;
                width: 80px !important;
            height: 30px;
  
        }
  button{
    margin: 1px;
  }
      #message {
             display: none;
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background-color: #ffffff; /* White background for the form */
              color: black;
              padding: 20px;
              z-index: 1000; /* Ensure it's above other elements */
              size: 200px;
              font-weight: 700;
              justify-content: space-between;
              align-content: space-between;
              align-items: center;
              font-size: 14px;
              box-shadow: 0px 0px 12px  rgba(0, 0, 0, 0.3) !important; /* Add a subtle box shadow */
              border-radius: 8px; /* Optional: Add border-radius for rounded corners */
              overflow: hidden; 
        }
    form input{
        
        margin: 2px;
    }
        form button{
           width: 100px !important;
            padding: 5px;
            margin: 5px;  
        }
      .col input{
        width: 100%;

      }
      input[type=checkbox]{
        width: 100px;
        color: #8f8f8f !important;
      }
      
            </style> 
             <style>
        .align-right-top {
            position: absolute;
            top: 0;
            right: 0;
            margin: 10px; /* Optional: Add margin for spacing */
        }
    
    </style>
</head>
<body class="g-sidenav-show   bg-gray-100">
 {{>sidebar}}
  <main class="main-content position-relative border-radius-lg ">
    {{>navbar}}
    <div class="table-responsive container-fluid py-4  ">
          
        
        <div class=" form-control card ">
              <form action="" class=" form-control ">
<div class="row">
  <div class="col">
    <div class="custom-input-container">
        <td> <input type="text" placeholder=" " name="id" id="id">
      <label for="id">Purchase No</label></td>
     
    </div>

    <div class="custom-input-container">
      <input type="text" placeholder=" " name="code" id="code">
      <label for="code">Purchase Date</label>
    </div>

    <div class="custom-input-container">
      <input type="text" placeholder=" " name="customername" id="customername">
      <label for="customername">Supplier Name</label>
    </div>
  </div>

  <div class="col">
    <div class="custom-input-container">
      <input type="text" placeholder=" " name="subgroup" id="subgroup">
      <label for="subgroup">Payment Mode</label>
    </div>

    <div class="custom-input-container">
      <input type="text" placeholder=" " name="gstin" id="gstin">
      <label for="gstin">Supplier Invoice No</label>
    </div>

    <div class="custom-input-container">
      <input type="text" placeholder=" " name="pan" id="pan">
      <label for="pan">Supplier Invoice Date</label>
    </div>
  </div>

  <div class="col">
    <div class="custom-input-container">
      <input type="text" placeholder=" " name="contactPerson" id="contactPerson">
      <label for="contactPerson">Mode Of Transport</label>
    </div>

    <div class="custom-input-container">
      <input type="text" placeholder=" " name="mobile" id="mobile">
      <label for="mobile">Transport No</label>
    </div>

    <div class="custom-input-container">
      <input type="text" placeholder=" " name="phone" id="phone">
      <label for="phone">Supp.Invoice Amount</label>
    </div>
  </div>
</div>
            </form>
            <h3>Purchase </h3>
    
   
           <form action="/auth/customer" method="get">
             <table id="customerTable" class="table-responsive justify-content-between align-items-end" style="width:100% !important">
         
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Batch No</th>
                        <th>Tax(%)</th>
                        <th>KGS</th>
                        <th>NOS</th>
                        <th>Rate</th>
                        <th>Disc.Mode</th>
                        <th>Disc</th>
                        <th>Amount</th>
                        <th>CGST</th>
                        <th>SGST</th>
                        <th>IGST</th>
                        <th>Total Amount</th>
                        <th class="action">Action</th>
                        <th>Print</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            
             <button type="button" value="button" class="btn btn-primary" id="addmanufacturer" >add</button>
            </form>

<form id="manufacturerforms" class="form-control" style="display: block;" method="post" action="/auth/customer">
    <div class="row">
        <div class="col">
            <div class="custom-input-container">
              <input type="text" placeholder=" " name="amount" id="amount">
              <label for="amount">Amount</label>
            </div>

            <div class="custom-input-container">
              <input type="text" placeholder=" " name="igst" id="igst">
              <label for="igst">IGST</label>
            </div>

            <div class="custom-input-container">
              <input type="text" placeholder=" " name="cgst" id="cgst">
              <label for="cgst">CGST</label>
            </div>

            <div class="custom-input-container">
              <input type="text" placeholder=" " name="sgst" id="sgst">
              <label for="sgst">SGST</label>
            </div>
        </div>
        <div class="col">
            <div class="custom-input-container">
              <input type="text" placeholder=" " name="subTotal" id="subTotal">
              <label for="subTotal">Sub Total</label>
            </div>

            <div class="custom-input-container">
              <input type="text" placeholder=" " name="cess" id="cess">
              <label for="cess">CESS</label>
            </div>

            <div class="custom-input-container">
              <input type="text" placeholder=" " name="tcs" id="tcs">
              <label for="tcs">TCS</label>
            </div>

            <div class="custom-input-container">
              <input type="text" placeholder=" " name="discMode" id="discMode">
              <label for="discMode">Disc Mode</label>
            </div>
        </div>
        <div class="col">
            <div class="custom-input-container">
              <input type="text" placeholder=" " name="discPercentage" id="discPercentage">
              <label for="discPercentage">Disc (%)</label>
            </div>

            <div class="custom-input-container">
              <input type="text" placeholder=" " name="roundOff" id="roundOff">
              <label for="roundOff">Round Off</label>
            </div>

            <div class="custom-input-container">
              <input type="text" placeholder=" " name="netAmount" id="netAmount">
              <label for="netAmount">Net Amount</label>
            </div>
        </div>
    </div>

    <div class="btn-container">
      <button type="submit" class="btn btn-primary" id="saveManufacturer">Save</button>
      <button type="submit" class="btn btn-primary" id="saveDraft" style="white-space: nowrap;">Save Draft</button>
      <button type="button" class="btn btn-primary" id="closeForm">Close</button>
    </div>
</form>
            </div>
 
        </div>
   

 
{{>footer}}
  
  </main>
 
  {{>color}}
  

 <script>
    document.getElementById("filter-button").addEventListener("click", function() {
        var fromDate = new Date(document.getElementById("fromDate").value);
        var toDate = new Date(document.getElementById("toDate").value);
        var table = document.getElementById("customerTable");
        var rows = table.getElementsByTagName("tr");
        var hasData = false;

        for (var i = 1; i < rows.length; i++) {
            var cell = rows[i].getElementsByTagName("td")[0];
            if (cell) {
                var cellDate = new Date(cell.innerText);
                if (!isNaN(cellDate)) {  // Check if date parsing is successful
                    if (cellDate >= fromDate && cellDate <= toDate) {
                        rows[i].style.display = "";
                        hasData = true;
                    } else {
                        rows[i].style.display = "none";
                    }
                }
            }
        }

        // Check if noDataRow is defined before accessing it
        var noDataRow = document.getElementById("noDataRow");
        if (noDataRow) {
            if (!hasData) {
                noDataRow.style.display = "block";
            } else {
                noDataRow.style.display = "none";
            }
        }
    });
</script> 

  <script>
    document.addEventListener('DOMContentLoaded', function () {
    // Wait for the DOM to be fully loaded
    var messageElement = document.getElementById('message');

    if (messageElement) {
        // If the message element exists
        setTimeout(function () {
            // Set a timeout to hide the message after 2 seconds
            messageElement.style.display = 'none';
        }, 1000); // 2000 milliseconds = 2 seconds
    }
});
  </script>
    <script>
        // Add form button click event
        $(document).on('click', '#addmanufacturer', function() {
        $("#manufacturerform").show();
        $("#id").val('');
    });
       var table = $("#customerTable").DataTable({
   

    searching:false,
    paging: false,
    scrollY: '250px',
    scrollX: '100px',
    scrollCollapse: true,
    responsive: true,
     "bInfo": true, // Show information (records, etc.)
    "bBorders": true, // Show borders
});

        if (table.rows().count() === 0) {
            $("#emptyMessage").show();
        }
    </script>
<script>
   // Handle click event for the "Edit" button
$(document).on('click', '.editBtn', function() {
    // Get the data associated with the clicked row
    var data = table.row($(this).parents('tr')).data();

    console.log('Data:', data);

    // Check if the data is valid and an object
    if (data && typeof data === 'object' && !Array.isArray(data)) {
        // Populate the edit form fields with the data
        $(".editForm #id").val(data.id);
        $(".editForm #code").val(data.code);
        $(".editForm #customername").val(data.customername);
        $(".editForm #subgroup").val(data.subgroup);
        $(".editForm #gstin").val(data.gstin);
        $(".editForm #pan").val(data.pan);
        $(".editForm #contactPerson").val(data.contactPerson);
        $(".editForm #mobile").val(data.mobile);
        $(".editForm #phone").val(data.phone);
        $(".editForm #email").val(data.email);
        $(".editForm #creditday").val(data.creditday);
        $(".editForm #creditlimit").val(data.creditlimit);
        $(".editForm #allowdisc").val(data.allowdisc);
        $(".editForm #disc").val(data.disc);
        $(".editForm #pmtmode").val(data.pmtmode);
        $(".editForm #address").val(data.address);
        $(".editForm #city").val(data.city);
        $(".editForm #state").val(data.state);
        $(".editForm #location").val(data.location);
        $(".editForm #pincode").val(data.pincode);
        $(".editForm #beneficeiryname").val(data.beneficeiryname);
        $(".editForm #acctnumber").val(data.acctnumber);
        $(".editForm #ifsc").val(data.ifsc);
        $(".editForm #bankname").val(data.bankname);
        $(".editForm #bankbranch").val(data.bankbranch);
        $(".editForm #bankphone").val(data.bankphone);
        $(".editForm #openingdate").val(data.openingdate);
        $(".editForm #dramount").val(data.dramount);
        $(".editForm #cramount").val(data.cramount);
        // Check if 'active' property is true and set the checkbox accordingly
        if (data.active) {
            $(".editForm #active").prop('checked', true);
        } else {
            $(".editForm #active").prop('checked', false);
        }

        // Show the edit form
        $(".editForm").show();
    } else {
        console.error('Invalid or undefined data:', data);
    }
});

// Handle form submission for the edit form
$(document).on('submit', '.editForm', function(event) {
    event.preventDefault();

    var formData = $(this).serialize();
    var customerId = $(".editForm #id").val();

    console.log('Form Data:', formData);

    $.ajax({
        type: 'PUT',
        url: 'http://localhost:5000/auth/customeredit/' + customerId,
        data: formData,
        success: function(response) {
            console.log(response);

            if (response.success) {
                // Update the table row with the new data
                var tableRow = table.row('#' + customerId); // Assuming each row has a unique ID
                tableRow.data(response.updatedCustomerData); // Use the actual key from the response

                // Optionally, you can hide the form after a successful update
                $(".editForm").hide();
                alert('Customer Updated Successfully 🖋');
                table.ajax.reload();
            } else {
                alert('Failed to update customer');
            }
        },
        error: function(error) {
            console.error('Error:', error);

            if (error.status === 0) {
                alert('Failed to connect to the server. Check your server and network connection.');
            } else {
                alert('Failed to update customer. Check the console for more details.');
            }
        }
    });
});

// Handle form close button for the edit form
$(document).on('click', '.editForm #closeForm', function() {
    $(".editForm").hide();
});


    // Handle form close button for the add form
    $(document).on('click', '#closeForm', function() {
        $("#manufacturerform").hide();
    });
</script>
<script>
// Handle form close button
$('#closeForm').click(function() {
    // Hide the form when the close button is clicked
    $("#manufacturerform").hide();
});

$('#customerTable').on('click', '.deleteBtn', function() {
    var data = table.row($(this).parents('tr')).data();
    var deleteButton = $(this);  // Store the reference to 'this' for later use

    if (data && data.id) {
        var deleteUrl = 'http://localhost:5000/auth/customerdelete/' + data.id;
        console.log('Data:', data);

        $.ajax({
            type: 'DELETE',
            url: deleteUrl,
            success: function(response) {
                console.log(response);
                if (response.success) {
                    alert('Successfully Deleted 🗑');
                    table.ajax.reload();
                } else {
                    alert("Failed to delete customer: " + response.error);
                }
            },
            error: function(error) {
                console.error('Error deleting customer:', error);
                alert("Failed to delete customer. Check console for details.");
            }
        });
    } else {
        console.error('Invalid or undefined data:', data);
    }
});
</script>
<script>
  $(document).ready(function () {
    // Add focus and blur event listeners for each input
    $('.custom-input-container input').on('focus', function () {
      $(this).siblings('label').css({ top: '-15px', fontSize: '12px', color: '#333' });
    }).on('blur', function () {
      if (!$(this).val()) {
        $(this).siblings('label').css({ top: '0', fontSize: 'inherit', color: '#aaa' });
      }
    });
  });
</script>
</body>
</html>

<form id="manufacturerform" style="display: contain;" method="post" action="/auth/customer">
    <div class="row">
        <div class="col">
            <!-- First Column -->
            <input type="hidden" placeholder="Id" name="id" id="id">
            <input type="text" placeholder="Code No" name="code" id="code">
            <input type="text" placeholder="Customer Name" name="customername" id="customername">
            <input type="text" placeholder="Sub Group" name="subgroup" id="subgroup">
            <input type="text" placeholder="Gstin" name="gstin" id="gstin">
            <input type="text" placeholder="Pan" name="pan" id="pan">
            <input type="text" placeholder="Contact No" name="contactPerson" id="contactPerson">
            <input type="text" placeholder="Mobile" name="mobile" id="mobile">
            <input type="text" placeholder="Phone" name="phone" id="phone">
            <input type="text" placeholder="Email" name="email" id="email">
            <input type="text" placeholder="Credit Day" name="creditday" id="creditday">
            <input type="text" placeholder="Credit Limit" name="creditlimit" id="creditlimit">
            <input type="text" placeholder="Allow. Disc." name="allowdisc" id="allowdisc">
            <input type="text" placeholder="Disc(%)" name="disc" id="disc">
            <input type="text" placeholder="Pmt Mode" name="pmtmode" id="pmtmode">
        </div>
        <div class="col">
            <!-- Second Column -->
            <input type="text" placeholder="Address" name="address" id="address">
            <input type="text" placeholder="City" name="city" id="city">
            <input type="text" placeholder="State" name="state" id="state">
            <input type="text" placeholder="Location" name="location" id="location">
            <input type="text" placeholder="Pincode" name="pincode"  id="pincode">
            <input type="text" placeholder="Beneficiary Name" name="beneficeiryname" id="beneficeiryname">
            <input type="text" placeholder="Acct. number" name="acctnumber" id="acctnumber">
            <input type="text" placeholder="IFSC" name="ifsc" id="ifsc">
            <input type="text" placeholder="Bank Name" name="bankname" id="bankname">
            <input type="text" placeholder="Bank Branch" name="bankbranch" id="bankbranch">
            <input type="text" placeholder="Bank Phone" name="bankphone" id="bankphone">
            <input type="date" placeholder="Opening Date" name="openingdate" id="openingdate">
            <input type="text" placeholder="Dr Amount" name="dramount" id="dramount">
            <input type="text" placeholder="Cr Amount" name="cramount" id="cramount">
            <label for="active" style="font-size: 14px;">Active<input type="checkbox" id="active" value="1" name="active" ></label>
            
        </div>
    </div>
    <button type="submit" value="submit" class="btn btn-primary" id="saveManufacturer">Save</button>
    <button type="button" class="btn btn-primary" id="closeForm">Close</button>
</form>
  
<form class="editForm" method="put" action="/auth/customeredit/:id">
     <div class="row">
        <div class="col">
            <!-- First Column -->
            <input type="hidden" placeholder="Id" name="id" id="id">
            <input type="text" placeholder="Code No" name="code" id="code">
            <input type="text" placeholder="Customer Name" name="customername" id="customername">
            <input type="text" placeholder="Sub Group" name="subgroup" id="subgroup">
            <input type="text" placeholder="Gstin" name="gstin" id="gstin">
            <input type="text" placeholder="Pan" name="pan" id="pan">
            <input type="text" placeholder="Contact Person" name="contactPerson" id="contactPerson">
            <input type="text" placeholder="Mobile" name="mobile" id="mobile">
            <input type="text" placeholder="Phone" name="phone" id="phone">
            <input type="text" placeholder="Email" name="email" id="email">
            <input type="text" placeholder="Credit Day" name="creditday" id="creditday">
            <input type="text" placeholder="Credit Limit" name="creditlimit" id="creditlimit">
            <input type="text" placeholder="Allow. Disc." name="allowdisc" id="allowdisc">
            <input type="text" placeholder="Disc(%)" name="disc" id="disc">
            <input type="text" placeholder="Pmt Mode" name="pmtmode" id="pmtmode">
        </div>
        <div class="col">
            <!-- Second Column -->
            <input type="text" placeholder="Address" name="address" id="address">
            <input type="text" placeholder="City" name="city" id="city">
            <input type="text" placeholder="State" name="state" id="state">
            <input type="text" placeholder="Location" name="location" id="location">
            <input type="text" placeholder="Pincode" name="pincode" id="pincode">
            <input type="text" placeholder="Beneficiary Name" name="beneficeiryname" id="beneficeiryname">
            <input type="text" placeholder="Acct. number" name="acctnumber" id="acctnumber">
            <input type="text" placeholder="IFSC" name="ifsc" id="ifsc">
            <input type="text" placeholder="Bank Name" name="bankname" id="bankname">
            <input type="text" placeholder="Bank Branch" name="bankbranch" id="bankbranch">
            <input type="text" placeholder="Bank Phone" name="bankphone" id="bankphone">
            <input type="date" placeholder="Opening Date" name="openingdate" id="openingdate">
            <input type="text" placeholder="Dr Amount" name="dramount" id="dramount">
            <input type="text" placeholder="Cr Amount" name="cramount" id="cramount">
            <label for="active" style="font-size: 14px;">Active<input type="checkbox" id="active" name="active" value="true" ></label>
            
        </div>
    </div>
    <button type="submit" class="btn btn-primary">Update</button>
    <button type="button" class="btn btn-primary  " id="closeForm">Close</button>
</form>





  
    <script>
          $("#closeForm").click(function() {
            $(".editForm").hide();
        });
    </script>